/*! InstantDataScraperNext - 2024-01-30 */

function e(e,t,n,o,r,a,i){var s={},c=null,l=!1,d=!1,f={urls:["<all_urls>"],tabId:n,types:["main_frame","sub_frame","stylesheet","script","font","object","xmlhttprequest","other"]};function u(){!l&&d&&(i||function(e){e(!0)})(function(e){if(!e)return p();l||(l=!0,chrome.webRequest.onBeforeRequest.removeListener(h),chrome.webRequest.onCompleted.removeListener(g),chrome.webRequest.onErrorOccurred.removeListener(g),t())})}function h(e){s[e.requestId]=1,c=new Date}function g(e){c&&(delete s[e.requestId],Object.keys(s).length||p())}function p(){setTimeout(function(){new Date-c<r||Object.keys(s).length||u()},r)}chrome.webRequest.onBeforeRequest.addListener(h,f),chrome.webRequest.onCompleted.addListener(g,f),chrome.webRequest.onErrorOccurred.addListener(g,f),(e||function(e){e()})(function(){setTimeout(u,o),setTimeout(function(){d=!0,p()},a)})}function t(e,t){return t&&(e+=1462),(Date.parse(e)-new Date(Date.UTC(1899,11,30)))/864e5}function n(e,n){for(var o={},r={s:{c:1e7,r:1e7},e:{c:0,r:0}},a=0;a!=e.length;++a)for(var i=0;i!=e[a].length;++i){r.s.r>a&&(r.s.r=a),r.s.c>i&&(r.s.c=i),r.e.r<a&&(r.e.r=a),r.e.c<i&&(r.e.c=i);var s={v:e[a][i]};if(null!==s.v){var c=XLSX.utils.encode_cell({c:i,r:a});"number"==typeof s.v?s.t="n":"boolean"==typeof s.v?s.t="b":s.v instanceof Date?(s.t="n",s.z=XLSX.SSF._table[14],s.v=t(s.v)):s.t="s",o[c]=s}}return r.s.c<1e7&&(o["!ref"]=XLSX.utils.encode_range(r)),o}function o(e,t){e.data.unshift(e.fields);var o=new function e(){if(!(this instanceof e))return new e;this.SheetNames=[],this.Sheets={}},r=n(e.data);return o.SheetNames.push(t),o.Sheets[t]=r,XLSX.write(o,{type:"binary"})}function r(e){try{e()}catch(e){console.log("Error: ",e)}}import a from"./js/google-analytics.js";var i={id:parseInt(u("tabid")),url:u("url")},s={},c=1e3,l=null;async function d(){null!==i.url.toLowerCase().match(/\/\/[a-z]+\.linkedin\.com/)?($("#waitHeader").hide(),h("We're unable to collect data from LinkedIn. Sorry for the inconvenience.  If you have further questons please contact us at info@webrobots.io","noResponseErr",!1,!0)):(L(),setTimeout(function(){console.log("no response"),$("#waitHeader").is(":visible")&&k(!0)},5e4),$(window).resize(function(){S()}),R())}function f(e,t){return(t||".")+e.replace(/[!"#$%&'()*+,.\/:;<=>?@[\\\]^`{|}~]/g,"\\$&")}function u(e){for(var t=window.location.search.substring(1).split("&"),n=0;n<t.length;n++){var o=t[n].split("=");if(decodeURIComponent(o[0])==e)return decodeURIComponent(o[1])}}function h(e,t,n,o){if(""===e)return $("#"+t).hide();$("#"+t).show().text(e),n&&P(e),o&&a.fireEvent("Error",{url:s.startingUrl||i.url,msg:e})}function g(e){var t=e.length,n={"":1/0},o={},r={},a={},i={};function s(e){return e in n?n[e]:(n[e]=$(f(e)).length,n[e])}return e.forEach(function(e){for(var t in e)t in o||(o[t]=0),o[t]++}),Object.keys(o).map(function(e){return[o[e],e]}).forEach(function([n,o]){var c="",l=1/0;o.split(" ")[0].split("/").slice(1).reverse().forEach(function(e){e.split(".").slice(1).forEach(function(e){l<2*t||s(e)>=l||(c=e,l=s(e))})});var d=o.split(" ")[1],f=0,u=e.map(function(e){return o in e});d&&isNaN(d)&&(c+=" "+d),c in r?(r[c].forEach(function(e,t){if(!f){var n=!0;e.forEach(function(e,t){n&=!(u[t]&&e)}),n&&(f=t+1)}}),f?r[c][f-1]=r[c][f-1].map(function(e,t){return u[t]||e}):(r[c].push(u),f=r[c].length),f>1&&(c+=" "+f)):r[c]=[u],c in a||(a[c]=[]),a[c].push(o),c in i||(i[c]=0),i[c]+=n}),{names:r,namePaths:a,nameCounts:i}}function p(e){var t=e.length,{names:n,namePaths:o}=g(e),r=s.data.length/s.pages,a=g(e.slice(0,r)),i={},c={fields:n=Object.keys(o).filter(function(n){var c={},l=[];return!(n in s.config.deletedFields)&&(e.map(function(e){for(var t,r=0;r<o[n].length;r++)o[n][r]in e&&((t=e[o[n][r]])in c||(c[t]=0),c[t]++);l.push(t)}),Object.keys(c).length&&c[Object.keys(c)[0]]==t?(0,!1):(l=JSON.stringify(l))in i?(0,!1):(i[l]=1,n in a.nameCounts&&a.nameCounts[n]>=.2*r||(0,!1)))}),data:e.map(function(e){return n.map(function(t){for(var n=0;n<o[t].length;n++)if(o[t][n]in e)return e[o[t][n]];return""})})};return s.names=n,s.namePaths=o,c}function m(e){return e.map(function(e){return e in s.config.headers?s.config.headers[e]:e})}function w(e){var t=p(e);return t.fields=m(t.fields),t}function b(e){for(var t=new ArrayBuffer(e.length),n=new Uint8Array(t),o=0;o!=e.length;++o)n[o]=255&e.charCodeAt(o);return t}function v(){a.fireEvent("Download",{hostName:s.hostName,startingUrl:s.startingUrl,dataLength:s.data.length}),(()=>{let e=e=>{let t={};for(let n=0;n<4;n++)void 0!==e[n]?t[`selector${n}`]=e[n]:t[`selector${n}`]="";return t},t=Object.keys(s.config.headers).length;t&&U(!0).then(n=>{let[o,r]=n;const i=e=>r.find(t=>t.field_id===e);let c={tableId:s.tableId,hostName:s.hostName,startingUrl:s.startingUrl};if(t)for(name in s.config.headers){let t=i(s.config.headers[name]).selector.split(",").map(e=>e.slice(-100)),n=Object.assign(e(t),c,{originalName:name,newName:s.config.headers[name]});a.fireEvent("RenameColumn",n)}})})()}function S(){var e=p(s.data);e.data=e.data.slice(0,c),s.previewLength=e.data.length;var t=$(".wtHolder").scrollTop(),n=$(".wtHolder").scrollLeft(),o=!1;$("#hot").empty();new Handsontable($("#hot").get(0),{data:e.data,colHeaders:m(e.fields),wordWrap:!1,manualColumnResize:!0,width:$(window).width()-20,height:$(window).height()-$("#hot").get(0).getBoundingClientRect().y,afterRender:function(){o||(o=!0,$(".wtHolder").scrollTop(t),$(".wtHolder").scrollLeft(n))},modifyColWidth:function(e,t){if(e>300)return 300},afterGetColHeader:function(t,n){if(-1!=t){$(n).children().length>1?$(".hot-header",n).remove():$(n).click(function(){var e=this;setTimeout(function(){$(".header-input",e).trigger("focus")},20)});var o=$("<div>",{class:"hot-header"}),r=$("<div>",{class:"header-input",contenteditable:"true"});s.config.headers[e.fields[t]]?r.text(s.config.headers[e.fields[t]]):r.text(n.firstChild.textContent),$(n).append(o),o.append(r),o.append($("<span>",{class:"glyphicon glyphicon-remove remove-column",style:"padding-top: 2.5px"}).click(function(){s.config.deletedFields[e.fields[t]]=!0,y(),$("#resetColumns").show(),S()})),r.get(0).addEventListener("input",function(n){s.config.headers[e.fields[t]]=r.text(),y()}),n.firstChild.style.display="none"}},beforeOnCellMouseDown:function(e,t,n){t.row<0&&e.stopImmediatePropagation()}})}function y(){localStorage.setItem(s.configName,JSON.stringify(s.config))}function k(e){$("#waitHeader").hide(),h("Instant Data doesn't support data extraction from this site yet. Our administrators are notified and will try to add support in the future. Thanks for trying us out!","noResponseErr",!1,!0)}function x(){return localStorage.getItem("nextSelector:"+s.hostName)}function C(e,t){if(!e)return i.reloaded?k():(i.reloaded=!0,chrome.tabs.reload(i.id,{},function(){chrome.tabs.onUpdated.addListener(function e(t,n){"complete"===n.status&&t===i.id&&(chrome.tabs.onUpdated.removeListener(e),R())})}));s.tableId=e.tableId,s.scraping=!1,s.failedToProcess=!1,s.processingError=null,s.tableSelector=e.tableSelector,s.startingUrl=e.href,s.hostName=e.hostname,s.previewLength=0,s.configName=e.hostname+"-config",s.config=JSON.parse(localStorage.getItem(s.configName))||{headers:{},deletedFields:{},crawlDelay:1e3,maxWait:2e4},r(t?()=>a.firePageViewEvent(s.hostName,s.startingUrl):()=>a.fireEvent("AnotherTable",{hostName:s.hostName,startingUrl:s.startingUrl})),Object.keys(s.config.deletedFields).length&&$("#resetColumns").show();var n=N(i.url);$("#wrongTable").show(),s.config.infinateScrollChecked&&($("#nextButton").hide(),$("#startScraping").show(),$("#infinateScroll").prop("checked",!0)),chrome.tabs.sendMessage(i.id,{action:"getTableData"},function(e){e&&e.error?h("Something went wrong!","noResponseErr",!0):e.tableId==s.tableId&&(e.failedToProcess?(h("Failed to process rows on server. Showing raw data instead.","error",!1),s.failedToProcess=!0,s.processingError=e.processingError):($("#error").hide(),s.failedToProcess=!1),s.pages||s.config.infinateScrollChecked||$("#nextButton").show(),s.pages||(s.nextSelector=x(),s.nextSelector&&chrome.tabs.sendMessage(i.id,{action:"markNextButton",selector:s.nextSelector},function(e){e.error||$("#startScraping").show()})),$("#wait").hide(),$("#content").show(),h('Download data or locate "Next" to crawl multiple pages',"instructions"),s.data=e.data,s.pages=1,s.lastRows=e.data.length,s.tableSelector=e.tableSelector,s.goodClasses=e.goodClasses,s.workingTime=0,j(),$(".download-button").show(),S(),$("#csv").off("click").click(function(){console.log("Downloading CSV..."),r(v),q({download:!0});let e=w(s.data);e.data.forEach((t,n)=>{t.forEach((t,o)=>{Array.isArray(t)&&(e.data[n][o]=Papa.unparse([t],{quotes:!0,escapeChar:'"'}))})}),saveAs(new Blob([Papa.unparse(e,{quotes:!0,escapeChar:'"'})],{type:"application/octet-stream"}),n+".csv")}),$("#xlsx").off("click").click(function(){r(v),q({download:!0}),saveAs(new Blob([b(o(w(s.data),i.url.substring(0,100)))],{type:"application/octet-stream"}),n+".xlsx")}),$("#copy").off("click").click(function(){r(v),q({download:!0}),E(Papa.unparse(w(s.data),{delimiter:"\t"}))}))})}function N(e){var t=new URL(e).hostname.split(".");return t[0].indexOf("www")>-1?t[1]:t[0]}function E(e){var t=function(t){t.preventDefault(),t.clipboardData?t.clipboardData.setData("text/plain",e):window.clipboardData&&window.clipboardData.setData("Text",e)};window.addEventListener("copy",t),document.execCommand("copy"),window.removeEventListener("copy",t)}function R(){chrome.tabs.sendMessage(i.id,{action:"findTables",robots:l},function(e){C(e,!0)})}function D(){return $("#infinateScroll").is(":checked")}function T(e){s.data=s.data.concat(e);var t=new Set;s.data.forEach(e=>t.add(JSON.stringify(e))),s.data=Array.from(t,e=>JSON.parse(e))}function I(){s.gettingNext=!1,s.scraping=!0,$("#startScraping").hide(),$("#stopScraping").show(),h("","error"),h('Please wait for more pages or press "Stop crawling".',"instructions"),D()&&$("#infinateScrollElement").hide();var t=new Date;!function n(){const o=function(e){let t={action:"scrollDown",selector:s.tableSelector};
chrome.tabs.sendMessage(i.id,t,function(t){if(t&&t.error)return h("","instructions"),h(t.error,t.errorId||"error",!0);$("#wrongTable").hide(),e()})};var r=function(e){chrome.tabs.sendMessage(i.id,{action:"clickNext",selector:s.nextSelector},function(t){if(t&&t.error)return h("","instructions"),h(t.error,t.errorId,!0);$("#wrongTable").hide(),e()})};D()&&(r=o),e(r,function(){chrome.tabs.sendMessage(i.id,{action:"getTableData",selector:s.tableSelector},function(e){if(e){if(e.error)return h("","instructions"),h(e.error,e.errorId||"error",!0);e.failedToProcess?(h("Failed to process rows. Showing raw data instead.","error",!1),s.failedToProcess=!0,s.processingError=e.processingError):($("#error").hide(),s.failedToProcess=!1),s.lastRows=e.data.length,s.pages++,s.workingTime+=new Date-t,t=new Date,T(e.data),j(),s.previewLength<c?S():h("Preview limited to 1000 rows.","previewLimit"),s.scraping&&n()}})},i.id,s.config.maxWait,100,s.config.crawlDelay,function(e){chrome.tabs.sendMessage(i.id,{},function(t){e(void 0!==t)})})}()}function L(){$("#stopScraping").click(P),$("#crawlDelay").bind("propertychange change click keyup input paste",function(){var e=$(this).val();if(isNaN(e)||e<0||parseInt(1e3*e)>=s.config.maxWait)return h("Bad min waiting value","inputError");h("","inputError"),s.config.crawlDelay=parseInt(1e3*e),y()}),$("#maxWait").bind("propertychange change click keyup input paste",function(){var e=$(this).val();if(isNaN(e)||parseInt(1e3*e)<=s.config.crawlDelay)return h("Bad max waiting value","inputError");h("","inputError"),s.config.maxWait=parseInt(1e3*e),y()}),$("#resetColumns").click(function(){s.config.deletedFields={},y(),$("#resetColumns").hide(),S()}),$("#infinateScroll").click(function(e){s.config.infinateScrollChecked?(s.config.infinateScrollChecked=!1,$("#nextButton").show(),x()?$("#startScraping").show():$("#startScraping").hide()):(s.config.infinateScrollChecked=!0,$("#nextButton").hide(),$("#startScraping").show()),y()})}function P(e=null){s.scraping=!1,console.log("Scraping stopped."),$("#startScraping").show(),$("#stopScraping").hide(),h("Crawling stopped. Please download data or continue crawling.","instructions")}function O(){$("#pleaseRate").show(),$("#rateLater").show().click(function(){q({rate:"later"}),$("#pleaseRate").hide(),r(()=>a.fireEvent("Click",{button:"Rate later"}))}),$("#rate").show().click(function(){q({rate:"now"}),$("#pleaseRate").hide(),r(()=>a.fireEvent("Click",{button:"Rate now"})),chrome.tabs.create({url:"https://chrome.google.com/webstore/detail/instant-data-scraper/ofaokhiedipichpaobibbnahnkdoiiah/reviews"})})}function q(e){var t=JSON.parse(localStorage.getItem("stats"))||{pages:0,rows:0,downloads:0,tabs:0,lastRateRequest:null,lastDownloads:0,lastRows:0,rated:!1};e.download?t.downloads++:e.rate?("later"==e.rate&&(t.lastRateRequest=(new Date).getTime(),t.lastDownloads=t.downloads,t.lastRows=t.rows),"now"==e.rate&&(t.rated=!0)):(1==s.pages&&t.tabs++,t.pages++,t.rows+=s.lastRows),!t.rated&&(new Date).getTime()-t.lastRateRequest>52704e5&&t.downloads-t.lastDownloads>9&&t.rows-t.lastRows>999&&O(),localStorage.setItem("stats",JSON.stringify(t))}function j(){$("#stats").empty().append($("<div>",{text:"Pages scraped: "+s.pages})).append($("<div>",{text:"Rows collected: "+s.data.length})).append($("<div>",{text:"Rows from last page: "+s.lastRows})).append($("<div>",{text:"Working time: "+parseInt(s.workingTime/1e3)+"s"})),q({})}async function U(e=!1){var t=s.tableSelector.replace(".tablescraper-selected-table",""),n=[];s.goodClasses.map(e=>e.split(" ").map(e=>"."+e).join("")).forEach(e=>{(e=e.replace(/.tablescraper-selected-row/g,"")).length&&n.push(t+" "+e+":not(:empty)")}),n.length||n.push(t+" > *:not(:empty)");var o=n.join(","),r=[];let a=s.names;for(var i of(e&&(a=a.concat(Object.keys(s.config.deletedFields))),a)){var c=s.namePaths[i];let e={target:"text"};e.field_id=i,e.param="",s.config.headers[i]&&(e.field_id=s.config.headers[i]);let t=[];for(var l of c){let n="";try{console.log("Picking selector..."),n=await B(o,l)}catch(e){console.log(e)}console.log("Selector picked: ",n),t.push(n),(l=l.split(" ")).filter(e=>"href"==e).length&&(e.target="prop",e.param="href"),l.filter(e=>"src"==e).length&&(e.target="prop",e.param="src")}e.selector=t.join(","),r.push(e)}return[o,r]}function B(e,t){return new Promise((n,o)=>{chrome.tabs.sendMessage(i.id,{action:"chooseSelector",rowSelector:e,path:t},function(e){e?n(e.selector):o(new Error("Could not choose selector!"))})})}d(),$("#wrongTable").click(function(){$("#hot").empty(),chrome.tabs.sendMessage(i.id,{action:"nextTable"},C)}),$("#nextButton").click(function(){h('Mark "Next" button or link',"instructions"),s.gettingNext=!0,function e(){chrome.tabs.sendMessage(i.id,{action:"getNextButton"},function(t){s.scraping||(s.gettingNext&&e(),t.selector&&($("#startScraping").show(),h('"Next" button located. Press "Start crawling" to get more pages or mark another button/link if marked incorrectly.',"instructions"),s.nextSelector=t.selector,localStorage.setItem("nextSelector:"+s.hostName,t.selector)))})}()}),$("#startScraping").click(I);
/*!
	Papa Parse
	v4.1.2
	https://github.com/mholt/PapaParse
*/
!function(e){"use strict";function t(t,r){if(r=r||{},r.worker&&S.WORKERS_SUPPORTED){var n=f();return n.userStep=r.step,n.userChunk=r.chunk,n.userComplete=r.complete,n.userError=r.error,r.step=m(r.step),r.chunk=m(r.chunk),r.complete=m(r.complete),r.error=m(r.error),delete r.worker,void n.postMessage({input:t,config:r,workerId:n.id})}var o=null;return"string"==typeof t?o=r.download?new i(r):new a(r):(e.File&&t instanceof File||t instanceof Object)&&(o=new s(r)),o.stream(t)}function r(e,t){function r(){"object"==typeof t&&("string"==typeof t.delimiter&&1==t.delimiter.length&&-1==S.BAD_DELIMITERS.indexOf(t.delimiter)&&(u=t.delimiter),("boolean"==typeof t.quotes||t.quotes instanceof Array)&&(o=t.quotes),"string"==typeof t.newline&&(h=t.newline))}function n(e){if("object"!=typeof e)return[];var t=[];for(var r in e)t.push(r);return t}function i(e,t){var r="";"string"==typeof e&&(e=JSON.parse(e)),"string"==typeof t&&(t=JSON.parse(t));var n=e instanceof Array&&e.length>0,i=!(t[0]instanceof Array);if(n){for(var a=0;a<e.length;a++)a>0&&(r+=u),r+=s(e[a],a);t.length>0&&(r+=h)}for(var o=0;o<t.length;o++){for(var f=n?e.length:t[o].length,c=0;f>c;c++){c>0&&(r+=u);var d=n&&i?e[c]:c;r+=s(t[o][d],c)}o<t.length-1&&(r+=h)}return r}function s(e,t){if("undefined"==typeof e||null===e)return"";e=e.toString().replace(/"/g,'""');var r="boolean"==typeof o&&o||o instanceof Array&&o[t]||a(e,S.BAD_DELIMITERS)||e.indexOf(u)>-1||" "==e.charAt(0)||" "==e.charAt(e.length-1);return r?'"'+e+'"':e}function a(e,t){for(var r=0;r<t.length;r++)if(e.indexOf(t[r])>-1)return!0;return!1}var o=!1,u=",",h="\r\n";if(r(),"string"==typeof e&&(e=JSON.parse(e)),e instanceof Array){if(!e.length||e[0]instanceof Array)return i(null,e);if("object"==typeof e[0])return i(n(e[0]),e)}else if("object"==typeof e)return"string"==typeof e.data&&(e.data=JSON.parse(e.data)),e.data instanceof Array&&(e.fields||(e.fields=e.data[0]instanceof Array?e.fields:n(e.data[0])),e.data[0]instanceof Array||"object"==typeof e.data[0]||(e.data=[e.data])),i(e.fields||[],e.data||[]);throw"exception: Unable to serialize unrecognized input"}function n(t){function r(e){var t=_(e);t.chunkSize=parseInt(t.chunkSize),e.step||e.chunk||(t.chunkSize=null),this._handle=new o(t),this._handle.streamer=this,this._config=t}this._handle=null,this._paused=!1,this._finished=!1,this._input=null,this._baseIndex=0,this._partialLine="",this._rowCount=0,this._start=0,this._nextChunk=null,this.isFirstChunk=!0,this._completeResults={data:[],errors:[],meta:{}},r.call(this,t),this.parseChunk=function(t){if(this.isFirstChunk&&m(this._config.beforeFirstChunk)){var r=this._config.beforeFirstChunk(t);void 0!==r&&(t=r)}this.isFirstChunk=!1;var n=this._partialLine+t;this._partialLine="";var i=this._handle.parse(n,this._baseIndex,!this._finished);if(!this._handle.paused()&&!this._handle.aborted()){var s=i.meta.cursor;this._finished||(this._partialLine=n.substring(s-this._baseIndex),this._baseIndex=s),i&&i.data&&(this._rowCount+=i.data.length);var a=this._finished||this._config.preview&&this._rowCount>=this._config.preview;if(y)e.postMessage({results:i,workerId:S.WORKER_ID,finished:a});else if(m(this._config.chunk)){if(this._config.chunk(i,this._handle),this._paused)return;i=void 0,this._completeResults=void 0}return this._config.step||this._config.chunk||(this._completeResults.data=this._completeResults.data.concat(i.data),this._completeResults.errors=this._completeResults.errors.concat(i.errors),this._completeResults.meta=i.meta),!a||!m(this._config.complete)||i&&i.meta.aborted||this._config.complete(this._completeResults),a||i&&i.meta.paused||this._nextChunk(),i}},this._sendError=function(t){m(this._config.error)?this._config.error(t):y&&this._config.error&&e.postMessage({workerId:S.WORKER_ID,error:t,finished:!1})}}function i(e){function t(e){var t=e.getResponseHeader("Content-Range");return parseInt(t.substr(t.lastIndexOf("/")+1))}e=e||{},e.chunkSize||(e.chunkSize=S.RemoteChunkSize),n.call(this,e);var r;this._nextChunk=k?function(){this._readChunk(),this._chunkLoaded()}:function(){this._readChunk()},this.stream=function(e){this._input=e,this._nextChunk()},this._readChunk=function(){if(this._finished)return void this._chunkLoaded();if(r=new XMLHttpRequest,k||(r.onload=g(this._chunkLoaded,this),r.onerror=g(this._chunkError,this)),r.open("GET",this._input,!k),this._config.chunkSize){var e=this._start+this._config.chunkSize-1;r.setRequestHeader("Range","bytes="+this._start+"-"+e),r.setRequestHeader("If-None-Match","webkit-no-cache")}try{r.send()}catch(t){this._chunkError(t.message)}k&&0==r.status?this._chunkError():this._start+=this._config.chunkSize},this._chunkLoaded=function(){if(4==r.readyState){if(r.status<200||r.status>=400)return void this._chunkError();this._finished=!this._config.chunkSize||this._start>t(r),this.parseChunk(r.responseText)}},this._chunkError=function(e){var t=r.statusText||e;this._sendError(t)}}function s(e){e=e||{},e.chunkSize||(e.chunkSize=S.LocalChunkSize),n.call(this,e);var t,r,i="undefined"!=typeof FileReader;this.stream=function(e){this._input=e,r=e.slice||e.webkitSlice||e.mozSlice,i?(t=new FileReader,t.onload=g(this._chunkLoaded,this),t.onerror=g(this._chunkError,this)):t=new FileReaderSync,this._nextChunk()},this._nextChunk=function(){this._finished||this._config.preview&&!(this._rowCount<this._config.preview)||this._readChunk()},this._readChunk=function(){var e=this._input;if(this._config.chunkSize){var n=Math.min(this._start+this._config.chunkSize,this._input.size);e=r.call(e,this._start,n)}var s=t.readAsText(e,this._config.encoding);i||this._chunkLoaded({target:{result:s}})},this._chunkLoaded=function(e){this._start+=this._config.chunkSize,this._finished=!this._config.chunkSize||this._start>=this._input.size,this.parseChunk(e.target.result)},this._chunkError=function(){this._sendError(t.error)}}function a(e){e=e||{},n.call(this,e);var t,r;this.stream=function(e){return t=e,r=e,this._nextChunk()},this._nextChunk=function(){if(!this._finished){var e=this._config.chunkSize,t=e?r.substr(0,e):r;return r=e?r.substr(e):"",this._finished=!r,this.parseChunk(t)}}}function o(e){function t(){if(b&&d&&(h("Delimiter","UndetectableDelimiter","Unable to auto-detect delimiting character; defaulted to '"+S.DefaultDelimiter+"'"),d=!1),e.skipEmptyLines)for(var t=0;t<b.data.length;t++)1==b.data[t].length&&""==b.data[t][0]&&b.data.splice(t--,1);return r()&&n(),i()}function r(){return e.header&&0==y.length}function n(){if(b){for(var e=0;r()&&e<b.data.length;e++)for(var t=0;t<b.data[e].length;t++)y.push(b.data[e][t]);b.data.splice(0,1)}}function i(){if(!b||!e.header&&!e.dynamicTyping)return b;for(var t=0;t<b.data.length;t++){for(var r={},n=0;n<b.data[t].length;n++){if(e.dynamicTyping){var i=b.data[t][n];b.data[t][n]="true"==i||"TRUE"==i?!0:"false"==i||"FALSE"==i?!1:o(i)}e.header&&(n>=y.length?(r.__parsed_extra||(r.__parsed_extra=[]),r.__parsed_extra.push(b.data[t][n])):r[y[n]]=b.data[t][n])}e.header&&(b.data[t]=r,n>y.length?h("FieldMismatch","TooManyFields","Too many fields: expected "+y.length+" fields but parsed "+n,t):n<y.length&&h("FieldMismatch","TooFewFields","Too few fields: expected "+y.length+" fields but parsed "+n,t))}return e.header&&b.meta&&(b.meta.fields=y),b}function s(t){for(var r,n,i,s=[",","	","|",";",S.RECORD_SEP,S.UNIT_SEP],a=0;a<s.length;a++){var o=s[a],h=0,f=0;i=void 0;for(var c=new u({delimiter:o,preview:10}).parse(t),d=0;d<c.data.length;d++){var l=c.data[d].length;f+=l,"undefined"!=typeof i?l>1&&(h+=Math.abs(l-i),i=l):i=l}c.data.length>0&&(f/=c.data.length),("undefined"==typeof n||n>h)&&f>1.99&&(n=h,r=o)}return e.delimiter=r,{successful:!!r,bestDelimiter:r}}function a(e){e=e.substr(0,1048576);var t=e.split("\r");if(1==t.length)return"\n";for(var r=0,n=0;n<t.length;n++)"\n"==t[n][0]&&r++;return r>=t.length/2?"\r\n":"\r"}function o(e){var t=l.test(e);return t?parseFloat(e):e}function h(e,t,r,n){b.errors.push({type:e,code:t,message:r,row:n})}var f,c,d,l=/^\s*-?(\d*\.?\d+|\d+\.?\d*)(e[-+]?\d+)?\s*$/i,p=this,g=0,v=!1,k=!1,y=[],b={data:[],errors:[],meta:{}};if(m(e.step)){var R=e.step;e.step=function(n){if(b=n,r())t();else{if(t(),0==b.data.length)return;g+=n.data.length,e.preview&&g>e.preview?c.abort():R(b,p)}}}this.parse=function(r,n,i){if(e.newline||(e.newline=a(r)),d=!1,!e.delimiter){var o=s(r);o.successful?e.delimiter=o.bestDelimiter:(d=!0,e.delimiter=S.DefaultDelimiter),b.meta.delimiter=e.delimiter}var h=_(e);return e.preview&&e.header&&h.preview++,f=r,c=new u(h),b=c.parse(f,n,i),t(),v?{meta:{paused:!0}}:b||{meta:{paused:!1}}},this.paused=function(){return v},this.pause=function(){v=!0,c.abort(),f=f.substr(c.getCharIndex())},this.resume=function(){v=!1,p.streamer.parseChunk(f)},this.aborted=function(){return k},this.abort=function(){k=!0,c.abort(),b.meta.aborted=!0,m(e.complete)&&e.complete(b),f=""}}function u(e){e=e||{};var t=e.delimiter,r=e.newline,n=e.comments,i=e.step,s=e.preview,a=e.fastMode;if(("string"!=typeof t||S.BAD_DELIMITERS.indexOf(t)>-1)&&(t=","),n===t)throw"Comment character same as delimiter";n===!0?n="#":("string"!=typeof n||S.BAD_DELIMITERS.indexOf(n)>-1)&&(n=!1),"\n"!=r&&"\r"!=r&&"\r\n"!=r&&(r="\n");var o=0,u=!1;this.parse=function(e,h,f){function c(e){b.push(e),S=o}function d(t){return f?p():("undefined"==typeof t&&(t=e.substr(o)),w.push(t),o=g,c(w),y&&_(),p())}function l(t){o=t,c(w),w=[],O=e.indexOf(r,o)}function p(e){return{data:b,errors:R,meta:{delimiter:t,linebreak:r,aborted:u,truncated:!!e,cursor:S+(h||0)}}}function _(){i(p()),b=[],R=[]}if("string"!=typeof e)throw"Input must be a string";var g=e.length,m=t.length,v=r.length,k=n.length,y="function"==typeof i;o=0;var b=[],R=[],w=[],S=0;if(!e)return p();if(a||a!==!1&&-1===e.indexOf('"')){for(var C=e.split(r),E=0;E<C.length;E++){var w=C[E];if(o+=w.length,E!==C.length-1)o+=r.length;else if(f)return p();if(!n||w.substr(0,k)!=n){if(y){if(b=[],c(w.split(t)),_(),u)return p()}else c(w.split(t));if(s&&E>=s)return b=b.slice(0,s),p(!0)}}return p()}for(var x=e.indexOf(t,o),O=e.indexOf(r,o);;)if('"'!=e[o])
  if(n&&0===w.length&&e.substr(o,k)===n){if(-1==O)return p();o=O+v,O=e.indexOf(r,o),x=e.indexOf(t,o)}else if(-1!==x&&(O>x||-1===O))w.push(e.substring(o,x)),o=x+m,x=e.indexOf(t,o);else{if(-1===O)break;if(w.push(e.substring(o,O)),l(O+v),y&&(_(),u))return p();if(s&&b.length>=s)return p(!0)}else{var I=o;for(o++;;){var I=e.indexOf('"',I+1);if(-1===I)return f||R.push({type:"Quotes",code:"MissingQuotes",message:"Quoted field unterminated",row:b.length,index:o}),d();if(I===g-1){var D=e.substring(o,I).replace(/""/g,'"');return d(D)}if('"'!=e[I+1]){if(e[I+1]==t){w.push(e.substring(o,I).replace(/""/g,'"')),o=I+1+m,x=e.indexOf(t,o),O=e.indexOf(r,o);break}if(e.substr(I+1,v)===r){if(w.push(e.substring(o,I).replace(/""/g,'"')),l(I+1+v),x=e.indexOf(t,o),y&&(_(),u))return p();if(s&&b.length>=s)return p(!0);break}}else I++}}return d()},this.abort=function(){u=!0},this.getCharIndex=function(){return o}}function h(){var e=document.getElementsByTagName("script");return e.length?e[e.length-1].src:""}function f(){if(!S.WORKERS_SUPPORTED)return!1;if(!b&&null===S.SCRIPT_PATH)throw new Error("Script path cannot be determined automatically when Papa Parse is loaded asynchronously. You need to set Papa.SCRIPT_PATH manually.");var t=S.SCRIPT_PATH||v;t+=(-1!==t.indexOf("?")?"&":"?")+"papaworker";var r=new e.Worker(t);return r.onmessage=c,r.id=w++,R[r.id]=r,r}function c(e){var t=e.data,r=R[t.workerId],n=!1;if(t.error)r.userError(t.error,t.file);else if(t.results&&t.results.data){var i=function(){n=!0,d(t.workerId,{data:[],errors:[],meta:{aborted:!0}})},s={abort:i,pause:l,resume:l};if(m(r.userStep)){for(var a=0;a<t.results.data.length&&(r.userStep({data:[t.results.data[a]],errors:t.results.errors,meta:t.results.meta},s),!n);a++);delete t.results}else m(r.userChunk)&&(r.userChunk(t.results,s,t.file),delete t.results)}t.finished&&!n&&d(t.workerId,t.results)}function d(e,t){var r=R[e];m(r.userComplete)&&r.userComplete(t),r.terminate(),delete R[e]}function l(){throw"Not implemented."}function p(t){var r=t.data;if("undefined"==typeof S.WORKER_ID&&r&&(S.WORKER_ID=r.workerId),"string"==typeof r.input)e.postMessage({workerId:S.WORKER_ID,results:S.parse(r.input,r.config),finished:!0});else if(e.File&&r.input instanceof File||r.input instanceof Object){var n=S.parse(r.input,r.config);n&&e.postMessage({workerId:S.WORKER_ID,results:n,finished:!0})}}function _(e){if("object"!=typeof e)return e;var t=e instanceof Array?[]:{};for(var r in e)t[r]=_(e[r]);return t}function g(e,t){return function(){e.apply(t,arguments)}}function m(e){return"function"==typeof e}var v,k=!e.document&&!!e.postMessage,y=k&&/(\?|&)papaworker(=|&|$)/.test(e.location.search),b=!1,R={},w=0,S={};if(S.parse=t,S.unparse=r,S.RECORD_SEP=String.fromCharCode(30),S.UNIT_SEP=String.fromCharCode(31),S.BYTE_ORDER_MARK="ï»¿",S.BAD_DELIMITERS=["\r","\n",'"',S.BYTE_ORDER_MARK],S.WORKERS_SUPPORTED=!k&&!!e.Worker,S.SCRIPT_PATH=null,S.LocalChunkSize=10485760,S.RemoteChunkSize=5242880,S.DefaultDelimiter=",",S.Parser=u,S.ParserHandle=o,S.NetworkStreamer=i,S.FileStreamer=s,S.StringStreamer=a,"undefined"!=typeof module&&module.exports?module.exports=S:m(e.define)&&e.define.amd?define(function(){return S}):e.Papa=S,e.jQuery){var C=e.jQuery;C.fn.parse=function(t){function r(){if(0==a.length)return void(m(t.complete)&&t.complete());var e=a[0];if(m(t.before)){var r=t.before(e.file,e.inputElem);if("object"==typeof r){if("abort"==r.action)return void n("AbortError",e.file,e.inputElem,r.reason);if("skip"==r.action)return void i();"object"==typeof r.config&&(e.instanceConfig=C.extend(e.instanceConfig,r.config))}else if("skip"==r)return void i()}var s=e.instanceConfig.complete;e.instanceConfig.complete=function(t){m(s)&&s(t,e.file,e.inputElem),i()},S.parse(e.file,e.instanceConfig)}function n(e,r,n,i){m(t.error)&&t.error({name:e},r,n,i)}function i(){a.splice(0,1),r()}var s=t.config||{},a=[];return this.each(function(){var t="INPUT"==C(this).prop("tagName").toUpperCase()&&"file"==C(this).attr("type").toLowerCase()&&e.FileReader;if(!t||!this.files||0==this.files.length)return!0;for(var r=0;r<this.files.length;r++)a.push({file:this.files[r],inputElem:this,instanceConfig:C.extend({},s)})}),r(),this}}y?e.onmessage=p:S.WORKERS_SUPPORTED&&(v=h(),document.body?document.addEventListener("DOMContentLoaded",function(){b=!0},!0):b=!0),i.prototype=Object.create(n.prototype),i.prototype.constructor=i,s.prototype=Object.create(n.prototype),s.prototype.constructor=s,a.prototype=Object.create(a.prototype),a.prototype.constructor=a}("undefined"!=typeof window?window:this);
